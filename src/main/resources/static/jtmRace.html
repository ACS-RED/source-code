<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üê¥ Ï†ÅÌÜ†Îßà Ïã§ÏãúÍ∞Ñ Î†àÏù¥Ïä§ üê¥</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Black+Han+Sans&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Press Start 2P', monospace;
            background: #1a1a2e;
            background-image: url('img/redhorse.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #eee;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(3px);
            z-index: -1;
        }
        
        .main-container {
            display: flex;
            min-height: 100vh;
            gap: 15px;
            padding: 15px;
            max-width: 1920px;
            margin: 0 auto;
            position: relative;
            justify-content: space-between;
        }
        
        .left-panel {
            width: 250px;
            flex-shrink: 0;
        }
        
        .center-panel {
            width: 800px;
            flex-shrink: 0;
        }
        
        .ad-panel {
            width: 400px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .ad-row {
            display: flex;
            gap: 8px;
        }
        
        .ad-row img {
            width: calc(50% - 4px);
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-row a {
            display: block;
            width: calc(50% - 4px);
        }
        
        .ad-row a img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .ad-row a {
            display: block;
            width: calc(50% - 4px);
        }
        
        .ad-row a img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-row a img:hover {
            transform: scale(1.05);
            border: 3px solid #ff0000;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        .ad-row img:hover {
            transform: scale(1.05);
            border: 3px solid #ff0000;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        .ad-row a img:hover {
            transform: none;
            animation: none;
        }
        
        .ad-panel > img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-panel > img:hover {
            transform: scale(1.05);
            border: 3px solid #ffd700;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        @keyframes neonRotate {
            0% { box-shadow: 30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
            25% { box-shadow: 0 30px 40px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 0, 0, 1); }
            50% { box-shadow: -30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
            75% { box-shadow: 0 -30px 40px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 0, 0, 1); }
            100% { box-shadow: 30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff0000, #ff6b00, #ffd700, #ff0000);
            background-size: 200% 200%;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.5);
            width: 800px;
            animation: gradientShift 2s ease infinite, neonPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes neonPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.5);
                border-color: #ffd700;
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 0, 0, 0.8), 0 0 80px rgba(255, 107, 107, 0.6);
                border-color: #ff0000;
            }
        }
        
        .header h1 {
            color: #fff;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6b00, 0 0 30px #ffd700, 2px 2px 0px #000;
            margin-bottom: 6px;
            animation: textGlow 1s ease-in-out infinite alternate;
            font-size: 24px;
            letter-spacing: 5px;
            font-family: 'Black Han Sans', sans-serif;
        }
        
        @keyframes textGlow {
            from { 
                text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6b00, 0 0 30px #ffd700, 2px 2px 0px #000;
                transform: scale(1);
            }
            to { 
                text-shadow: 0 0 20px #ff0000, 0 0 30px #ff6b00, 0 0 40px #ffd700, 0 0 50px #ff0000, 2px 2px 0px #000;
                transform: scale(1.05);
            }
        }
        
        .player-info {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 2px solid #fff;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 800px;
        }
        
        .player-info h3 {
            color: #fff;
            text-shadow: 1px 1px 0px #000;
            margin: 0;
            font-size: 12px;
        }
        
        .player-details {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .player-name {
            color: #4ecdc4;
            font-weight: bold;
            font-size: 10px;
        }
        
        .player-points {
            color: #ffd700;
            font-weight: bold;
            font-size: 10px;
        }
        
        .status-display {
            text-align: center;
            font-size: 12px;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(45deg, #16213e, #0f3460);
            border: 3px solid #4ecdc4;
            border-radius: 10px;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            width: 800px;
        }
        
        .race-track { 
            background: url('img/Í≤ΩÍ∏∞Ïû•.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            width: 800px;
            height: 400px; 
            position: relative; 
            border: 3px solid #fff;
            border-radius: 15px;
            margin-bottom: 15px; 
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.3);
        }
        
        .clouds {
            position: absolute;
            top: 5%;
            left: 0;
            right: 0;
            height: 25%;
            background: 
                radial-gradient(ellipse 80px 40px at 15% 60%, rgba(255,255,255,0.9) 40%, transparent 50%),
                radial-gradient(ellipse 60px 30px at 35% 70%, rgba(255,255,255,0.8) 40%, transparent 50%),
                radial-gradient(ellipse 100px 50px at 65% 50%, rgba(255,255,255,0.9) 40%, transparent 50%),
                radial-gradient(ellipse 70px 35px at 85% 65%, rgba(255,255,255,0.8) 40%, transparent 50%);
            animation: float 30s linear infinite;
        }
        
        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(-100px); }
        }
        
        .spectators {
            position: absolute;
            top: 30%;
            left: 0;
            right: 0;
            height: 15%;
            background: 
                /* 3Ï§ÑÏùò Í¥ÄÏ§ëÏÑù */
                repeating-linear-gradient(
                    90deg,
                    #FF6B6B 0px, #FF6B6B 3px,
                    #4ECDC4 3px, #4ECDC4 6px,
                    #45B7D1 6px, #45B7D1 9px,
                    #F9CA24 9px, #F9CA24 12px,
                    #6C5CE7 12px, #6C5CE7 15px,
                    #E17055 15px, #E17055 18px,
                    #00B894 18px, #00B894 21px,
                    #FDCB6E 21px, #FDCB6E 24px
                ),
                repeating-linear-gradient(
                    0deg,
                    rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 15px,
                    transparent 15px, transparent 30px
                );
            animation: cheer 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes cheer {
            0% { transform: translateY(0px) scaleY(1); }
            100% { transform: translateY(-2px) scaleY(1.05); }
        }
        
        .track-fence {
            position: absolute;
            top: 85%;
            left: 0;
            right: 0;
            height: 3%;
            background: repeating-linear-gradient(
                90deg,
                #654321 0px, #654321 8px,
                #8B4513 8px, #8B4513 12px,
                #654321 12px, #654321 20px
            );
            border-top: 2px solid #4A4A4A;
        }
        
        .finish-line {
            position: absolute;
            right: 50px;
            top: 45%;
            height: 35%;
            width: 12px;
            background: repeating-linear-gradient(
                0deg,
                #000 0px, #000 12px,
                #fff 12px, #fff 24px
            );
            border: 3px solid #333;
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0,0,0,0.3);
        }
        
        .finish-flag {
            position: absolute;
            right: 35px;
            top: 40%;
            font-size: 28px;
            animation: wave 2s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        @keyframes wave {
            0%, 100% { transform: rotate(-8deg) scale(1); }
            50% { transform: rotate(8deg) scale(1.1); }
        }
        
        .track-lines {
            position: absolute;
            top: 45%;
            left: 0;
            right: 0;
            height: 35%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent 0px, transparent 70px,
                    rgba(139, 115, 85, 0.4) 70px, rgba(139, 115, 85, 0.4) 72px
                );
        }
        
        .diamond-logo {
            position: absolute;
            bottom: 5%;
            right: 5%;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            transform: rotate(45deg);
            border: 2px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .race-track::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 48px,
                    rgba(255,255,255,0.1) 48px,
                    rgba(255,255,255,0.1) 50px
                );
        }
        
        .finish-line {
            display: none; /* Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄÏùò Í≤∞ÏäπÏÑ† ÏÇ¨Ïö© */
        }
        
        .finish-flag {
            display: none; /* Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄÏùò Í≤∞ÏäπÏÑ† ÏÇ¨Ïö© */
        }
        
        @keyframes wave {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .horse { 
            position: absolute; 
            width: 60px;
            height: 60px;
            transition: left 0.5s ease-in-out; 
            z-index: 5;
        }
        
        .horse img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.5));
        }
        
        .horse-1 { top: 170px; left: 50px; }
        .horse-2 { top: 210px; left: 50px; }
        .horse-3 { top: 250px; left: 50px; }
        .horse-4 { top: 290px; left: 50px; }
        
        .horse-name-tag {
            position: absolute;
            top: 50%;
            left: -45px;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            border: 1px solid #fff;
            white-space: nowrap;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: translateY(-50%) scale(1); }
            50% { opacity: 1; transform: translateY(-50%) scale(1.05); }
        }
        
        @keyframes horsePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .speed-indicator {
            position: absolute;
            top: 50%;
            right: -15px;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 0px #000;
        }
        
        @keyframes speedFlash {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; color: #4ecdc4; }
        }
        
        @keyframes finalSprint {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-2px) scale(1.05); }
        }
        
        .betting-section { 
            background: linear-gradient(135deg, #16213e, #0f3460);
            padding: 15px; 
            border-radius: 12px; 
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
            height: fit-content;
        }
        
        .betting-section h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            font-size: 11px;
        }
        
        .bet-amount-section {
            margin: 20px 0;
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4ecdc4;
        }
        
        .bet-amount-section input {
            background: #1a1a2e;
            color: #4ecdc4;
            border: 2px solid #4ecdc4;
            padding: 8px 12px;
            margin: 10px 5px;
            border-radius: 5px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-align: center;
            width: 80px;
        }
        
        .horse-betting {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .horse-bet-item {
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .horse-name {
            font-weight: bold;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            margin-bottom: 8px;
            display: block;
        }
        
        .bet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 10px;
        }
        
        .bet-total {
            color: #ffd700;
            text-shadow: 1px 1px 0px #000;
        }
        
        .bet-total.blinded .amount {
            color: #666;
            text-decoration: line-through;
        }
        
        .my-bet {
            color: #90EE90;
            text-shadow: 1px 1px 0px #000;
        }
        
        .bet-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: 2px solid #fff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 9px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 3px 0px #c0392b;
            width: 100%;
        }
        
        .bet-button:hover {
            transform: translateY(1px);
            box-shadow: 0 2px 0px #c0392b;
        }
        
        .bet-button:active {
            transform: translateY(3px);
            box-shadow: none;
        }
        
        .pixel-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: #fff;
            border: 3px solid #fff;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 4px 0px #2c5aa0;
        }
        
        .pixel-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #2c5aa0;
        }
        
        .ranking-button {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: 3px solid #fff;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 11px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 4px 0px #d35400;
            width: 200px;
        }
        
        .ranking-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #d35400;
        }
        
        
        .winner-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            text-align: center;
            z-index: 2000;
            animation: popupAppear 0.5s ease-out;
        }
        
        @keyframes popupAppear {
            from { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.5); 
            }
            to { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }
        
        .ranking-panel {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            color: white;
            border: 3px solid #ecf0f1;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .ranking-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .clouds {
            display: none; /* Î∞∞Í≤Ω Ïù¥ÎØ∏ÏßÄÏóê ÌïòÎäòÏù¥ ÏûàÏúºÎØÄÎ°ú Ï†úÍ±∞ */
        }
        
        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(-100px); }
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ÏôºÏ™Ω Ìå®ÎÑê: Î≤†ÌåÖ ÏÑπÏÖò -->
        <div class="left-panel">
            <div class="betting-section">
                <h3>üí∞ Î≤†ÌåÖÌïòÍ∏∞</h3>
                
                <div class="bet-amount-section">
                    <div style="margin-bottom: 10px;">Î≤†ÌåÖ Í∏àÏï°:</div>
                    <input type="number" id="betAmount" value="100" min="10" max="1000" step="10">
                    <div style="margin-top: 5px; font-size: 10px;">Ìè¨Ïù∏Ìä∏</div>
                </div>
                
                <div class="horse-betting">
                    <div class="horse-bet-item">
                        <span class="horse-name">üî¥ Ï†ÅÌÜ†Îßà</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal1">Ï¥ù: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet1">ÎÇ¥: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(1)" id="betBtn1">Î≤†ÌåÖÌïòÍ∏∞</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">üü§ Ï≤≠ÌÜ†Îßà</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal2">Ï¥ù: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet2">ÎÇ¥: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(2)" id="betBtn2">Î≤†ÌåÖÌïòÍ∏∞</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">‚ö™ Î∞±ÌÜ†Îßà</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal3">Ï¥ù: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet3">ÎÇ¥: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(3)" id="betBtn3">Î≤†ÌåÖÌïòÍ∏∞</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">‚ö´ ÌùëÌÜ†Îßà</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal4">Ï¥ù: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet4">ÎÇ¥: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(4)" id="betBtn4">Î≤†ÌåÖÌïòÍ∏∞</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ï§ëÏïô Ìå®ÎÑê: Í≤åÏûÑ Î©îÏù∏ -->
        <div class="center-panel">
            <div class="header">
                <h1>üê¥ Ï†ÅÌÜ†Îßà Ïã§ÏãúÍ∞Ñ Î†àÏù¥Ïä§ üê¥</h1>
            </div>

            <div class="player-info">
                <h3>üë§ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥</h3>
                <div class="player-details">
                    <div class="player-name"><span id="user-name">ÌÖåÏä§Ìä∏Ïú†Ï†Ä</span></div>
                    <div class="player-points" id="user-points">üíé Î≥¥Ïú†: 0P</div>
                </div>
                <div style="margin-top: 5px;">
                    <button class="pixel-button" onclick="logout()" style="font-size: 9px; padding: 8px 12px; background: #ff4f4f;">Î°úÍ∑∏ÏïÑÏõÉ</button>
                </div>
            </div>
            
            <div id="deleted-user-marquee" style="display: none; position: fixed; top: 50%; left: 0; width: 100%; z-index: 2000; pointer-events: none;">
                <div style="background: rgba(255, 0, 0, 0.9); padding: 20px 0; overflow: hidden;">
                    <div id="marquee-text" style="white-space: nowrap; animation: marquee 8s linear; font-size: 24px; color: #ffd700; text-shadow: 3px 3px 0px #000, 0 0 20px #ff0000;">
                    </div>
                </div>
            </div>

            <div class="status-display">
                <h2 id="status-text">üèÅ Í≤ΩÍ∏∞ ÎåÄÍ∏∞ Ï§ë: 30Ï¥à</h2>
            </div>
            
            <div class="race-track" id="track">
                <div class="horse horse-1" id="horse-1">
                    <img src="img/horse_red_transparent.gif" alt="Ï†ÅÌÜ†Îßà">
                    <div class="horse-name-tag">Ï†ÅÌÜ†Îßà</div>
                    <div class="speed-indicator" id="speed-1">‚ö°</div>
                </div>
                <div class="horse horse-2" id="horse-2">
                    <img src="img/horse_brown_transparent.gif" alt="Ï≤≠ÌÜ†Îßà">
                    <div class="horse-name-tag">Ï≤≠ÌÜ†Îßà</div>
                    <div class="speed-indicator" id="speed-2">‚ö°</div>
                </div>
                <div class="horse horse-3" id="horse-3">
                    <img src="img/horse_white_transparent.gif" alt="Î∞±ÌÜ†Îßà">
                    <div class="horse-name-tag">Î∞±ÌÜ†Îßà</div>
                    <div class="speed-indicator" id="speed-3">‚ö°</div>
                </div>
                <div class="horse horse-4" id="horse-4">
                    <img src="img/horse_black_transparent.gif" alt="ÌùëÌÜ†Îßà">
                    <div class="horse-name-tag">ÌùëÌÜ†Îßà</div>
                    <div class="speed-indicator" id="speed-4">‚ö°</div>
                </div>
            </div>
            
            <!-- Îû≠ÌÇπ Î≤ÑÌäºÏùÑ race-track Î∞îÎ°ú ÏïÑÎûòÏóê Î∞∞Ïπò -->
            <div style="margin-top: 15px;">
                <button class="ranking-button" onclick="location.href='/ranking.html'">üèÜ Îû≠ÌÇπ Î≥¥Í∏∞</button>
            </div>
        </div>
        
        <!-- Í¥ëÍ≥† Ìå®ÎÑê -->
        <div class="ad-panel">
            <div class="ad-row">
                <a href="https://false-pump-f46.notion.site/2-AWS-EC2-3Tier-2e0bf5e428628093884ef7a3e87996ee" target="_blank">
                    <img src="img/Í¥ëÍ≥†/1.redhorse.jpg" alt="Í¥ëÍ≥†1">
                </a>
                <img src="img/Í¥ëÍ≥†/2.redbul.jpg" alt="Í¥ëÍ≥†2">
            </div>
            <div class="ad-row">
                <img src="img/Í¥ëÍ≥†/3.ÏÑ§ÎÇ†Í¥ëÍ≥†.jpeg" alt="Í¥ëÍ≥†3">
                <img src="img/Í¥ëÍ≥†/4. ÏÑ§ÎÇ†Í¥ëÍ≥†.jpeg" alt="Í¥ëÍ≥†4">
            </div>
            <img src="img/Í¥ëÍ≥†/5.Î∞îÎã§Ïù¥ÏïºÍ∏∞.jpg" alt="Í¥ëÍ≥†5">
            <img src="img/Í¥ëÍ≥†/6.ÎÖ∏Ïä§Ïù¥Ïä§Ìä∏.jpg" alt="Í¥ëÍ≥†6">
            <div class="ad-row">
                <img src="img/Í¥ëÍ≥†/7.Ïû¨ÎÇúÏù¥ÎØ∏ÏßÄ.jpg" alt="Í¥ëÍ≥†7">
                <img src="img/Í¥ëÍ≥†/7.Ïû¨ÎÇúÏù¥ÎØ∏ÏßÄ.jpg" alt="Í¥ëÍ≥†7-2">
            </div>
        </div>
    </div>

    <div class="ranking-panel" id="ranking-panel" style="display: none;">
        <h3>üèÜ ÌîåÎ†àÏù¥Ïñ¥ Îû≠ÌÇπ</h3>
        <div id="ranking-list"></div>
        <button class="pixel-button" onclick="hideRanking()">Îã´Í∏∞</button>
    </div>

    <div id="winner-announcement" style="display:none;" class="winner-popup"></div>
    <div id="custom-alert" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(45deg, #16213e, #0f3460); padding: 30px; border-radius: 15px; border: 3px solid #4ecdc4; box-shadow: 0 0 30px rgba(78, 205, 196, 0.5); z-index: 3000; text-align: center; min-width: 300px;">
        <p id="alert-message" style="color: #fff; font-size: 14px; margin-bottom: 20px; text-shadow: 1px 1px 0px #000;"></p>
        <button onclick="hideCustomAlert()" style="background: linear-gradient(45deg, #4ecdc4, #44a08d); color: #fff; border: 2px solid #fff; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Press Start 2P', monospace; font-size: 10px;">ÌôïÏù∏</button>
    </div>

    <script>
        let currentUser = null;
        
        function showCustomAlert(message) {
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').style.display = 'block';
        }
        
        function hideCustomAlert() {
            document.getElementById('custom-alert').style.display = 'none';
        }
        
        function enableBetting() {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`betBtn${i}`);
                btn.disabled = false;
                btn.style.background = 'linear-gradient(45deg, #ff6b6b, #ff8e53)';
                btn.style.cursor = 'pointer';
            }
        }
        
        function disableBetting() {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`betBtn${i}`);
                btn.disabled = true;
                btn.style.background = '#888';
                btn.style.cursor = 'not-allowed';
            }
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÇ¨Ïö©Ïûê Ï¥àÍ∏∞Ìôî
        function initUser() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                // ÏÉà ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± - ÏûÖÏû• ÌéòÏù¥ÏßÄÏóêÏÑú ÏûÖÎ†•Ìïú ÎãâÎÑ§ÏûÑ ÏÇ¨Ïö©
                const enteredNickname = localStorage.getItem('enteredNickname');
                const username = enteredNickname || 'ÌîåÎ†àÏù¥Ïñ¥' + Math.floor(Math.random() * 10000);
                localStorage.removeItem('enteredNickname'); // ÏÇ¨Ïö© ÌõÑ Ï†úÍ±∞
                
                fetch('/api/user/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: username })
                })
                .then(response => response.json())
                .then(data => {
                    currentUser = { id: data.id, name: data.username, points: data.points };
                    localStorage.setItem('userId', data.id);
                    updateUserInfo();
                    startPolling();
                })
                .catch(error => console.error('ÏÇ¨Ïö©Ïûê ÏÉùÏÑ± Ïò§Î•ò:', error));
            } else {
                // Í∏∞Ï°¥ ÏÇ¨Ïö©Ïûê Î°úÎìú
                fetch(`/api/user/${userId}`)
                    .then(response => response.json())
                    .then(data => {
                        currentUser = { id: data.id, name: data.username, points: data.points };
                        updateUserInfo();
                        startPolling();
                    })
                    .catch(error => {
                        console.error('ÏÇ¨Ïö©Ïûê Î°úÎìú Ïò§Î•ò:', error);
                        localStorage.removeItem('userId');
                        initUser();
                    });
            }
        }
        
        function startPolling() {
            initializeBettingDisplay();
            updateBettingTotals();
            updateUserBets();
            setInterval(updateDisplay, 1000);
            setInterval(updateUserInfo, 5000);
            setInterval(updateBettingTotals, 3000);
            setInterval(updateUserBets, 3000);
        }
        let myBets = { 1: 0, 2: 0, 3: 0, 4: 0 };
        let raceStatus = 'READY';
        let serverTimer = 60;

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎÇ¥ Î≤†ÌåÖ Ï†ïÎ≥¥ Ï¥àÍ∏∞Ìôî
        function initializeBettingDisplay() {
            console.log('Î≤†ÌåÖ ÎîîÏä§ÌîåÎ†àÏù¥ Ï¥àÍ∏∞Ìôî Ï§ë...');
            for (let horseId = 1; horseId <= 4; horseId++) {
                const myBetElement = document.getElementById(`myBet${horseId}`);
                if (myBetElement) {
                    myBetElement.textContent = `ÎÇ¥: 0P`;
                    console.log(`Îßê ${horseId} Î≤†ÌåÖ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å`);
                } else {
                    console.error(`myBet${horseId} ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå`);
                }
            }
        }

        function updateDisplay() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    raceStatus = data.status;
                    serverTimer = data.timer;
                    
                    let statusText = '';
                    if (data.status === 'READY') {
                        statusText = `üèÅ Í≤ΩÍ∏∞ ÎåÄÍ∏∞ Ï§ë: ${data.timer}Ï¥à`;
                        winnerShown = false;
                        deletedUserShown = false;
                        enableBetting();
                    } else if (data.status === 'RACING') {
                        statusText = 'üèÉ‚Äç‚ôÇÔ∏è Í≤ΩÏ£º ÏßÑÌñâ Ï§ë!';
                        disableBetting();
                    } else if (data.status === 'FINISHED') {
                        statusText = `üéâ Í≤ΩÏ£º ÏôÑÎ£å! Ïö∞Ïäπ: ${data.winnerHorse}`;
                        disableBetting();
                        if (data.topWinner) {
                            showWinnerAnnouncement(data.winnerHorse, data.topWinner);
                        }
                    }
                    document.getElementById('status-text').textContent = statusText;
                    
                    // ÏÇ≠Ï†úÎêú ÏÇ¨Ïö©Ïûê Î©îÏãúÏßÄ ÌëúÏãú (1Î≤àÎßå)
                    if (data.deletedUser && !deletedUserShown) {
                        deletedUserShown = true;
                        const msgDiv = document.getElementById("deleted-user-marquee");
                        const msgText = document.getElementById("marquee-text");
                        const deletedMessage = data.deletedUser;
                        msgText.textContent = "üíÄ " + deletedMessage;
                        
                        msgDiv.style.display = "block";
                        msgText.style.animation = "none";
                        setTimeout(() => {
                            msgText.style.animation = "marquee 8s linear";
                        }, 10);
                        
                        setTimeout(() => {
                            msgDiv.style.display = "none";
                            
                            // ÌòÑÏû¨ ÏÇ¨Ïö©ÏûêÍ∞Ä ÌååÏÇ∞ÌñàÎäîÏßÄ ÌôïÏù∏
                            if (deletedMessage.includes(currentUser.name)) {
                                localStorage.removeItem('userId');
                                alert('ÌååÏÇ∞ÌïòÏó¨ Í≥ÑÏ†ïÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§. Î©îÏù∏ ÌôîÎ©¥ÏúºÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
                                window.location.href = 'index.html';
                            }
                        }, 8000);
                    }
                    
                    data.horses.forEach((horse, index) => {
                        const horseElement = document.getElementById(`horse-${horse.id}`);
                        const speedElement = document.getElementById(`speed-${horse.id}`);
                        if (horseElement) {
                            const trackWidth = 800 - 120;
                            
                            if (data.status === 'READY') {
                                // READY ÏÉÅÌÉúÏóêÏÑúÎäî Ìï≠ÏÉÅ ÏãúÏûë ÏúÑÏπò
                                horseElement.style.left = '50px';
                                speedElement.style.display = 'none';
                                horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5))';
                                horseElement.style.animation = 'horsePulse 2s ease-in-out infinite';
                                horseElement.style.transform = 'scale(1)';
                            } else {
                                // RACING/FINISHED ÏÉÅÌÉúÏóêÏÑúÎäî Ïã§Ï†ú ÏúÑÏπò Í≥ÑÏÇ∞
                                const position = (horse.position / 1000) * trackWidth + 50;
                                horseElement.style.left = position + 'px';
                                speedElement.style.display = 'block';
                                horseElement.style.animation = 'none';
                                
                                const randomVariation = (Math.random() - 0.5) * 20;
                                const currentSpeed = Math.max(30, Math.min(80, horse.speed + randomVariation));
                                
                                if (currentSpeed > 65) {
                                    speedElement.textContent = 'üî•';
                                    horseElement.style.transform = 'scale(1.1)';
                                    horseElement.style.filter = 'drop-shadow(0 0 8px #ff4757) saturate(1.3)';
                                } else if (currentSpeed > 55) {
                                    speedElement.textContent = '‚ö°';
                                    horseElement.style.transform = 'scale(1.05)';
                                    horseElement.style.filter = 'drop-shadow(0 0 5px #ffa502) saturate(1.1)';
                                } else if (currentSpeed > 45) {
                                    speedElement.textContent = 'üí®';
                                    horseElement.style.transform = 'scale(1)';
                                    horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5))';
                                } else {
                                    speedElement.textContent = 'üò¥';
                                    horseElement.style.transform = 'scale(0.95)';
                                    horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5)) grayscale(0.3)';
                                }
                                
                                const positions = data.horses.map(h => h.position).sort((a, b) => b - a);
                                if (horse.position === positions[0] && horse.position > 100) {
                                    horseElement.style.filter += ' drop-shadow(0 0 12px #ffd700)';
                                }
                                
                                if (horse.position > 800) {
                                    horseElement.style.animation = 'finalSprint 0.3s ease-in-out infinite';
                                }
                            }
                        }
                    });
                    
                    updateBettingTotals();
                })
                .catch(error => console.error('Error:', error));
        }

        function updateBettingTotals() {
            fetch('/api/betting-totals')
                .then(response => response.json())
                .then(data => {
                    console.log('Î∞õÏùÄ Î≤†ÌåÖ Îç∞Ïù¥ÌÑ∞:', data);
                    
                    // Í∞Å ÎßêÎ≥ÑÎ°ú Î≤†ÌåÖ Ï¥ùÏï° ÏóÖÎç∞Ïù¥Ìä∏
                    for (let horseId = 1; horseId <= 4; horseId++) {
                        const totalElement = document.getElementById(`betTotal${horseId}`);
                        if (totalElement) {
                            const amountSpan = totalElement.querySelector('.amount');
                            if (amountSpan) {
                                const totalAmount = data[horseId] || 0;
                                
                                // 10Ï¥à Ï†Ñ Î∏îÎùºÏù∏Îìú Ï≤òÎ¶¨ (READY ÏÉÅÌÉúÏóêÏÑúÎßå)
                                if (raceStatus === 'READY' && serverTimer <= 10) {
                                    amountSpan.textContent = '???';
                                    totalElement.style.opacity = '0.5';
                                } else {
                                    amountSpan.textContent = totalAmount;
                                    totalElement.style.opacity = '1';
                                }
                            }
                        }
                    }
                })
                .catch(error => console.error('Î≤†ÌåÖ Ï¥ùÏï° Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error));
        }

        function updateUserInfo() {
            fetch(`/api/user/${currentUser.id}`)
                .then(response => response.json())
                .then(data => {
                    currentUser.points = data.points;
                    currentUser.name = data.username;
                    document.getElementById('user-points').textContent = `üíé Î≥¥Ïú†: ${data.points}P`;
                    document.getElementById('user-name').textContent = data.username;
                })
                .catch(error => console.error('Error:', error));
        }

        function updateUserBets() {
            console.log('updateUserBets Ìï®Ïàò Ìò∏Ï∂úÎê®');
            fetch(`/api/user/${currentUser.id}/bets`)
                .then(response => {
                    console.log('ÏÇ¨Ïö©Ïûê Î≤†ÌåÖ API ÏùëÎãµ ÏÉÅÌÉú:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Î∞õÏùÄ ÏÇ¨Ïö©Ïûê Î≤†ÌåÖ Îç∞Ïù¥ÌÑ∞:', data);
                    
                    // Í∞Å ÎßêÎ≥ÑÎ°ú ÎÇ¥ Î≤†ÌåÖ Í∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏
                    for (let horseId = 1; horseId <= 4; horseId++) {
                        const myBetElement = document.getElementById(`myBet${horseId}`);
                        const myAmount = data[horseId] || 0;
                        
                        console.log(`Îßê ${horseId}: Î≤†ÌåÖÏï° ${myAmount}, ÏöîÏÜå Ï°¥Ïû¨:`, !!myBetElement);
                        
                        if (myBetElement) {
                            myBets[horseId] = myAmount;
                            myBetElement.textContent = `ÎÇ¥: ${myAmount}P`;
                            console.log(`Îßê ${horseId} ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å: ${myAmount}P`);
                        } else {
                            console.error(`myBet${horseId} ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå`);
                        }
                    }
                })
                .catch(error => {
                    console.error('ÏÇ¨Ïö©Ïûê Î≤†ÌåÖ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïò§Î•ò:', error);
                });
        }

        function placeBet(horseId) {
            const amount = parseInt(document.getElementById('betAmount').value);
            if (amount < 10 || amount > 1000) {
                showCustomAlert('Î≤†ÌåÖ Í∏àÏï°ÏùÄ 10~1000 Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïù¥Ïó¨Ïïº Ìï©ÎãàÎã§!');
                return;
            }
            
            console.log(`Îßê ${horseId}Ïóê ${amount}P Î≤†ÌåÖ ÏãúÎèÑ`);
            
            fetch('/api/bet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: currentUser.id,
                    horseId: horseId,
                    amount: amount
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Î≤†ÌåÖ ÏùëÎãµ:', data);
                showCustomAlert(data.message);
                if (data.success) {
                    console.log('Î≤†ÌåÖ ÏÑ±Í≥µ - Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
                    currentUser.points = data.user.points;
                    updateUserInfo();
                    updateBettingTotals();
                    // 1Ï¥à ÌõÑ ÏÇ¨Ïö©Ïûê Î≤†ÌåÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                    setTimeout(() => {
                        console.log('ÏÇ¨Ïö©Ïûê Î≤†ÌåÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë');
                        updateUserBets();
                    }, 1000);
                }
            })
            .catch(error => console.error('Î≤†ÌåÖ Ïò§Î•ò:', error));
        }

        function logout() {
            if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem('userId');
                window.location.href = 'index.html';
            }
        }

        let winnerShown = false;
        let deletedUserShown = false;
        
        function showWinnerAnnouncement(winner, topWinner) {
            const announcement = document.getElementById('winner-announcement');
            if (announcement.style.display === 'block' || winnerShown) return; // Ïù¥ÎØ∏ ÌëúÏãúÌñàÏúºÎ©¥ Ï§ëÎ≥µ Î∞©ÏßÄ
            
            winnerShown = true;
            let countdown = 10;
            
            const updateCountdown = () => {
                announcement.innerHTML = `
                    <h2 style="color: #fff; text-shadow: 2px 2px 0px #000; margin-bottom: 15px;">üéâ Í≤ΩÏ£º Í≤∞Í≥º üéâ</h2>
                    <p style="font-size: 16px; margin-bottom: 10px;">üèÜ Ïö∞Ïäπ: ${winner}</p>
                    <p style="font-size: 14px; color: #ffd700;">üí∞ ÏµúÍ≥† ÏàòÏùµ: ${topWinner}</p>
                    <p style="font-size: 12px; color: #aaa; margin-top: 15px;">${countdown}Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú Îã´ÌûôÎãàÎã§...</p>
                `;
            };
            
            updateCountdown();
            announcement.style.display = 'block';
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    hideWinnerAnnouncement();
                } else {
                    updateCountdown();
                }
            }, 1000);
        }

        function hideWinnerAnnouncement() {
            const announcement = document.getElementById('winner-announcement');
            announcement.style.display = 'none';
            announcement.innerHTML = '';
            winnerShown = false;
        }

        function hideRanking() {
            document.getElementById('ranking-panel').style.display = 'none';
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÇ¨Ïö©Ïûê Ï¥àÍ∏∞Ìôî
        initUser();
    </script>
</body>
</html>
