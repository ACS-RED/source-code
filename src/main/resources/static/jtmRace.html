<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ´ ì í† ë§ˆ ì‹¤ì‹œê°„ ë ˆì´ìŠ¤ ğŸ´</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Black+Han+Sans&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Press Start 2P', monospace;
            background: #1a1a2e;
            background-image: url('img/redhorse.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #eee;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.85);
            backdrop-filter: blur(3px);
            z-index: -1;
        }
        
        .main-container {
            display: flex;
            min-height: 100vh;
            gap: 15px;
            padding: 15px;
            max-width: 1920px;
            margin: 0 auto;
            position: relative;
            justify-content: space-between;
        }
        
        .left-panel {
            width: 250px;
            flex-shrink: 0;
        }
        
        .center-panel {
            width: 800px;
            flex-shrink: 0;
        }
        
        .ad-panel {
            width: 400px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .ad-row {
            display: flex;
            gap: 8px;
        }
        
        .ad-row img {
            width: calc(50% - 4px);
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-row a {
            display: block;
            width: calc(50% - 4px);
        }
        
        .ad-row a img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .ad-row a {
            display: block;
            width: calc(50% - 4px);
        }
        
        .ad-row a img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-row a img:hover {
            transform: scale(1.05);
            border: 3px solid #ff0000;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        .ad-row img:hover {
            transform: scale(1.05);
            border: 3px solid #ff0000;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        .ad-row a img:hover {
            transform: none;
            animation: none;
        }
        
        .ad-panel > img {
            width: 100%;
            border-radius: 5px;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .ad-panel > img:hover {
            transform: scale(1.05);
            border: 3px solid #ffd700;
            z-index: 10;
            animation: neonRotate 2s linear infinite;
        }
        
        @keyframes neonRotate {
            0% { box-shadow: 30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
            25% { box-shadow: 0 30px 40px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 0, 0, 1); }
            50% { box-shadow: -30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
            75% { box-shadow: 0 -30px 40px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 0, 0, 1); }
            100% { box-shadow: 30px 0 40px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 1); }
        }
        
        .header { 
            text-align: center; 
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff0000, #ff6b00, #ffd700, #ff0000);
            background-size: 200% 200%;
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.5);
            width: 800px;
            animation: gradientShift 2s ease infinite, neonPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes neonPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 0, 0, 0.5);
                border-color: #ffd700;
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 1), 0 0 60px rgba(255, 0, 0, 0.8), 0 0 80px rgba(255, 107, 107, 0.6);
                border-color: #ff0000;
            }
        }
        
        .header h1 {
            color: #fff;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6b00, 0 0 30px #ffd700, 2px 2px 0px #000;
            margin-bottom: 6px;
            animation: textGlow 1s ease-in-out infinite alternate;
            font-size: 24px;
            letter-spacing: 5px;
            font-family: 'Black Han Sans', sans-serif;
        }
        
        @keyframes textGlow {
            from { 
                text-shadow: 0 0 10px #ff0000, 0 0 20px #ff6b00, 0 0 30px #ffd700, 2px 2px 0px #000;
                transform: scale(1);
            }
            to { 
                text-shadow: 0 0 20px #ff0000, 0 0 30px #ff6b00, 0 0 40px #ffd700, 0 0 50px #ff0000, 2px 2px 0px #000;
                transform: scale(1.05);
            }
        }
        
        .player-info {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 2px solid #fff;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 800px;
        }
        
        .player-info h3 {
            color: #fff;
            text-shadow: 1px 1px 0px #000;
            margin: 0;
            font-size: 12px;
        }
        
        .player-details {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .player-name {
            color: #4ecdc4;
            font-weight: bold;
            font-size: 10px;
        }
        
        .player-points {
            color: #ffd700;
            font-weight: bold;
            font-size: 10px;
        }
        
        .status-display {
            text-align: center;
            font-size: 12px;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(45deg, #16213e, #0f3460);
            border: 3px solid #4ecdc4;
            border-radius: 10px;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            width: 800px;
        }
        
        .race-track { 
            background: url('img/ê²½ê¸°ì¥.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            width: 800px;
            height: 400px; 
            position: relative; 
            border: 3px solid #fff;
            border-radius: 15px;
            margin-bottom: 15px; 
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.3);
        }
        
        .clouds {
            position: absolute;
            top: 5%;
            left: 0;
            right: 0;
            height: 25%;
            background: 
                radial-gradient(ellipse 80px 40px at 15% 60%, rgba(255,255,255,0.9) 40%, transparent 50%),
                radial-gradient(ellipse 60px 30px at 35% 70%, rgba(255,255,255,0.8) 40%, transparent 50%),
                radial-gradient(ellipse 100px 50px at 65% 50%, rgba(255,255,255,0.9) 40%, transparent 50%),
                radial-gradient(ellipse 70px 35px at 85% 65%, rgba(255,255,255,0.8) 40%, transparent 50%);
            animation: float 30s linear infinite;
        }
        
        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(-100px); }
        }
        
        .spectators {
            position: absolute;
            top: 30%;
            left: 0;
            right: 0;
            height: 15%;
            background: 
                /* 3ì¤„ì˜ ê´€ì¤‘ì„ */
                repeating-linear-gradient(
                    90deg,
                    #FF6B6B 0px, #FF6B6B 3px,
                    #4ECDC4 3px, #4ECDC4 6px,
                    #45B7D1 6px, #45B7D1 9px,
                    #F9CA24 9px, #F9CA24 12px,
                    #6C5CE7 12px, #6C5CE7 15px,
                    #E17055 15px, #E17055 18px,
                    #00B894 18px, #00B894 21px,
                    #FDCB6E 21px, #FDCB6E 24px
                ),
                repeating-linear-gradient(
                    0deg,
                    rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 15px,
                    transparent 15px, transparent 30px
                );
            animation: cheer 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes cheer {
            0% { transform: translateY(0px) scaleY(1); }
            100% { transform: translateY(-2px) scaleY(1.05); }
        }
        
        .track-fence {
            position: absolute;
            top: 85%;
            left: 0;
            right: 0;
            height: 3%;
            background: repeating-linear-gradient(
                90deg,
                #654321 0px, #654321 8px,
                #8B4513 8px, #8B4513 12px,
                #654321 12px, #654321 20px
            );
            border-top: 2px solid #4A4A4A;
        }
        
        .finish-line {
            position: absolute;
            right: 50px;
            top: 45%;
            height: 35%;
            width: 12px;
            background: repeating-linear-gradient(
                0deg,
                #000 0px, #000 12px,
                #fff 12px, #fff 24px
            );
            border: 3px solid #333;
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0,0,0,0.3);
        }
        
        .finish-flag {
            position: absolute;
            right: 35px;
            top: 40%;
            font-size: 28px;
            animation: wave 2s ease-in-out infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        @keyframes wave {
            0%, 100% { transform: rotate(-8deg) scale(1); }
            50% { transform: rotate(8deg) scale(1.1); }
        }
        
        .track-lines {
            position: absolute;
            top: 45%;
            left: 0;
            right: 0;
            height: 35%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent 0px, transparent 70px,
                    rgba(139, 115, 85, 0.4) 70px, rgba(139, 115, 85, 0.4) 72px
                );
        }
        
        .diamond-logo {
            position: absolute;
            bottom: 5%;
            right: 5%;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            transform: rotate(45deg);
            border: 2px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .race-track::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 48px,
                    rgba(255,255,255,0.1) 48px,
                    rgba(255,255,255,0.1) 50px
                );
        }
        
        .finish-line {
            display: none; /* ë°°ê²½ ì´ë¯¸ì§€ì˜ ê²°ìŠ¹ì„  ì‚¬ìš© */
        }
        
        .finish-flag {
            display: none; /* ë°°ê²½ ì´ë¯¸ì§€ì˜ ê²°ìŠ¹ì„  ì‚¬ìš© */
        }
        
        @keyframes wave {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .horse { 
            position: absolute; 
            width: 60px;
            height: 60px;
            transition: left 0.5s ease-in-out; 
            z-index: 5;
        }
        
        .horse img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.5));
        }
        
        .horse-1 { top: 170px; left: 50px; }
        .horse-2 { top: 210px; left: 50px; }
        .horse-3 { top: 250px; left: 50px; }
        .horse-4 { top: 290px; left: 50px; }
        
        .horse-name-tag {
            position: absolute;
            top: 50%;
            left: -45px;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            border: 1px solid #fff;
            white-space: nowrap;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: translateY(-50%) scale(1); }
            50% { opacity: 1; transform: translateY(-50%) scale(1.05); }
        }
        
        @keyframes horsePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .speed-indicator {
            position: absolute;
            top: 50%;
            right: -15px;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 0px #000;
        }
        
        @keyframes speedFlash {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; color: #4ecdc4; }
        }
        
        @keyframes finalSprint {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-2px) scale(1.05); }
        }
        
        .betting-section { 
            background: linear-gradient(135deg, #16213e, #0f3460);
            padding: 15px; 
            border-radius: 12px; 
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
            height: fit-content;
        }
        
        .betting-section h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            font-size: 11px;
        }
        
        .bet-amount-section {
            margin: 20px 0;
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4ecdc4;
        }
        
        .bet-amount-section input {
            background: #1a1a2e;
            color: #4ecdc4;
            border: 2px solid #4ecdc4;
            padding: 8px 12px;
            margin: 10px 5px;
            border-radius: 5px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-align: center;
            width: 80px;
        }
        
        .horse-betting {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .horse-bet-item {
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .horse-name {
            font-weight: bold;
            color: #4ecdc4;
            text-shadow: 1px 1px 0px #000;
            margin-bottom: 8px;
            display: block;
        }
        
        .bet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 10px;
        }
        
        .bet-total {
            color: #ffd700;
            text-shadow: 1px 1px 0px #000;
        }
        
        .bet-total.blinded .amount {
            color: #666;
            text-decoration: line-through;
        }
        
        .my-bet {
            color: #90EE90;
            text-shadow: 1px 1px 0px #000;
        }
        
        .bet-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: 2px solid #fff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 9px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 3px 0px #c0392b;
            width: 100%;
        }
        
        .bet-button:hover {
            transform: translateY(1px);
            box-shadow: 0 2px 0px #c0392b;
        }
        
        .bet-button:active {
            transform: translateY(3px);
            box-shadow: none;
        }
        
        .pixel-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: #fff;
            border: 3px solid #fff;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 4px 0px #2c5aa0;
        }
        
        .pixel-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #2c5aa0;
        }
        
        .ranking-button {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: 3px solid #fff;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 11px;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s;
            box-shadow: 0 4px 0px #d35400;
            width: 200px;
        }
        
        .ranking-button:hover {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #d35400;
        }
        
        
        .winner-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #fff;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            text-align: center;
            z-index: 2000;
            animation: popupAppear 0.5s ease-out;
        }
        
        @keyframes popupAppear {
            from { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.5); 
            }
            to { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }
        
        .ranking-panel {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            color: white;
            border: 3px solid #ecf0f1;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .ranking-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .clouds {
            display: none; /* ë°°ê²½ ì´ë¯¸ì§€ì— í•˜ëŠ˜ì´ ìˆìœ¼ë¯€ë¡œ ì œê±° */
        }
        
        @keyframes float {
            from { transform: translateX(0); }
            to { transform: translateX(-100px); }
        }
        
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ì™¼ìª½ íŒ¨ë„: ë² íŒ… ì„¹ì…˜ -->
        <div class="left-panel">
            <div class="betting-section">
                <h3>ğŸ’° ë² íŒ…í•˜ê¸°</h3>
                
                <div class="bet-amount-section">
                    <div style="margin-bottom: 10px;">ë² íŒ… ê¸ˆì•¡:</div>
                    <input type="number" id="betAmount" value="100" min="10" max="1000" step="10">
                    <div style="margin-top: 5px; font-size: 10px;">í¬ì¸íŠ¸</div>
                </div>
                
                <div class="horse-betting">
                    <div class="horse-bet-item">
                        <span class="horse-name">ğŸ”´ ì í† ë§ˆ</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal1">ì´: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet1">ë‚´: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(1)" id="betBtn1">ë² íŒ…í•˜ê¸°</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">ğŸŸ¤ ì²­í† ë§ˆ</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal2">ì´: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet2">ë‚´: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(2)" id="betBtn2">ë² íŒ…í•˜ê¸°</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">âšª ë°±í† ë§ˆ</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal3">ì´: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet3">ë‚´: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(3)" id="betBtn3">ë² íŒ…í•˜ê¸°</button>
                    </div>
                    
                    <div class="horse-bet-item">
                        <span class="horse-name">âš« í‘í† ë§ˆ</span>
                        <div class="bet-info">
                            <span class="bet-total" id="betTotal4">ì´: <span class="amount">0</span>P</span>
                            <span class="my-bet" id="myBet4">ë‚´: 0P</span>
                        </div>
                        <button class="bet-button" onclick="placeBet(4)" id="betBtn4">ë² íŒ…í•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¤‘ì•™ íŒ¨ë„: ê²Œì„ ë©”ì¸ -->
        <div class="center-panel">
            <div class="header">
                <h1>ğŸ´ ì í† ë§ˆ ì‹¤ì‹œê°„ ë ˆì´ìŠ¤ ğŸ´</h1>
            </div>

            <div class="player-info">
                <h3>ğŸ‘¤ í”Œë ˆì´ì–´ ì •ë³´</h3>
                <div class="player-details">
                    <div class="player-name"><span id="user-name">í…ŒìŠ¤íŠ¸ìœ ì €</span></div>
                    <div class="player-points" id="user-points">ğŸ’ ë³´ìœ : 0P</div>
                </div>
                <div style="margin-top: 5px;">
                    <button class="pixel-button" onclick="logout()" style="font-size: 9px; padding: 8px 12px; background: #ff4f4f;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            
            <div id="deleted-user-marquee" style="display: none; position: fixed; top: 50%; left: 0; width: 100%; z-index: 2000; pointer-events: none;">
                <div style="background: rgba(255, 0, 0, 0.9); padding: 20px 0; overflow: hidden;">
                    <div id="marquee-text" style="white-space: nowrap; animation: marquee 8s linear; font-size: 24px; color: #ffd700; text-shadow: 3px 3px 0px #000, 0 0 20px #ff0000;">
                    </div>
                </div>
            </div>

            <div class="status-display">
                <h2 id="status-text">ğŸ ê²½ê¸° ëŒ€ê¸° ì¤‘: 30ì´ˆ</h2>
            </div>
            
            <div class="race-track" id="track">
                <div class="horse horse-1" id="horse-1">
                    <img src="img/horse_red_transparent.gif" alt="ì í† ë§ˆ">
                    <div class="horse-name-tag">ì í† ë§ˆ</div>
                    <div class="speed-indicator" id="speed-1">âš¡</div>
                </div>
                <div class="horse horse-2" id="horse-2">
                    <img src="img/horse_brown_transparent.gif" alt="ì²­í† ë§ˆ">
                    <div class="horse-name-tag">ì²­í† ë§ˆ</div>
                    <div class="speed-indicator" id="speed-2">âš¡</div>
                </div>
                <div class="horse horse-3" id="horse-3">
                    <img src="img/horse_white_transparent.gif" alt="ë°±í† ë§ˆ">
                    <div class="horse-name-tag">ë°±í† ë§ˆ</div>
                    <div class="speed-indicator" id="speed-3">âš¡</div>
                </div>
                <div class="horse horse-4" id="horse-4">
                    <img src="img/horse_black_transparent.gif" alt="í‘í† ë§ˆ">
                    <div class="horse-name-tag">í‘í† ë§ˆ</div>
                    <div class="speed-indicator" id="speed-4">âš¡</div>
                </div>
            </div>
            
            <!-- ë­í‚¹ ë²„íŠ¼ì„ race-track ë°”ë¡œ ì•„ë˜ì— ë°°ì¹˜ -->
            <div style="margin-top: 15px;">
                <button class="ranking-button" onclick="location.href='ranking.html'">ğŸ† ë­í‚¹ ë³´ê¸°</button>
            </div>
        </div>
        
        <!-- ê´‘ê³  íŒ¨ë„ -->
        <div class="ad-panel">
            <div class="ad-row">
                <a href="https://false-pump-f46.notion.site/2-AWS-EC2-3Tier-2e0bf5e428628093884ef7a3e87996ee" target="_blank">
                    <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad1(1024x501).jpg?v=1" alt="ê´‘ê³ 1">
                </a>
                <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad2(1024x501).jpg?v=1" alt="ê´‘ê³ 2">
            </div>
            <div class="ad-row">
                <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad3(800x533).jpg?v=1" alt="ê´‘ê³ 3">
                <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad4(800x533).jpg?v=1" alt="ê´‘ê³ 4">
            </div>
            <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad5(1024x256).jpg?v=1" alt="ê´‘ê³ 5">
            <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad6(1024x490).jpg?v=1" alt="ê´‘ê³ 6">
            <div class="ad-row">
                <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad7(1024x1024).jpg?v=1" alt="ê´‘ê³ 7">
                <img src="https://jmt-ad.s3.ap-northeast-2.amazonaws.com/ad8(1024x1024).jpg?v=1" alt="ê´‘ê³ 8">
            </div>
        </div>
    </div>

    <div class="ranking-panel" id="ranking-panel" style="display: none;">
        <h3>ğŸ† í”Œë ˆì´ì–´ ë­í‚¹</h3>
        <div id="ranking-list"></div>
        <button class="pixel-button" onclick="hideRanking()">ë‹«ê¸°</button>
    </div>

    <div id="winner-announcement" style="display:none;" class="winner-popup"></div>
    <div id="custom-alert" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(45deg, #16213e, #0f3460); padding: 30px; border-radius: 15px; border: 3px solid #4ecdc4; box-shadow: 0 0 30px rgba(78, 205, 196, 0.5); z-index: 3000; text-align: center; min-width: 300px;">
        <p id="alert-message" style="color: #fff; font-size: 14px; margin-bottom: 20px; text-shadow: 1px 1px 0px #000;"></p>
        <button onclick="hideCustomAlert()" style="background: linear-gradient(45deg, #4ecdc4, #44a08d); color: #fff; border: 2px solid #fff; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Press Start 2P', monospace; font-size: 10px;">í™•ì¸</button>
    </div>

    <script>
        let currentUser = null;
        
        function showCustomAlert(message) {
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').style.display = 'block';
        }
        
        function hideCustomAlert() {
            document.getElementById('custom-alert').style.display = 'none';
        }
        
        function enableBetting() {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`betBtn${i}`);
                btn.disabled = false;
                btn.style.background = 'linear-gradient(45deg, #ff6b6b, #ff8e53)';
                btn.style.cursor = 'pointer';
            }
        }
        
        function disableBetting() {
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`betBtn${i}`);
                btn.disabled = true;
                btn.style.background = '#888';
                btn.style.cursor = 'not-allowed';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì´ˆê¸°í™”
        async function initUser() {
            const storedUserId = localStorage.getItem('userId');

            async function fetchJson(url, options) {
                const res = await fetch(url, options);
                if (!res.ok) {
                    const text = await res.text().catch(() => '');
                    const err = new Error(`HTTP ${res.status}`);
                    err.status = res.status;
                    err.body = text;
                    throw err;
                }
                return res.json();
            }

            // 1. ê¸°ì¡´ ìœ ì €ê°€ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ í•´ë‹¹ ìœ ì € ë¡œë“œ ì‹œë„
            if (storedUserId) {
                try {
                    const data = await fetchJson(`/api/user/${storedUserId}`);
                    currentUser = {
                        id: data.id,
                        name: data.username,
                        points: data.points
                    };
                    updateUserInfo();
                    startPolling();
                    return;
                } catch (err) {
                    console.error('ê¸°ì¡´ ì‚¬ìš©ì ë¡œë“œ ì‹¤íŒ¨:', err);

                    // ì§„ì§œ ì—†ëŠ” ìœ ì €(404)ì¼ ë•Œë§Œ ì‚­ì œ í›„ ì¬ìƒì„±
                    if (err.status === 404) {
                        localStorage.removeItem('userId');
                        showCustomAlert('ìœ ì € ì •ë³´ê°€ ì—†ì–´ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.');
                        return initUser();
                    }

                    // ì„œë²„/ë„¤íŠ¸ì›Œí¬ ë¬¸ì œë©´ ì—¬ê¸°ì„œ ì¢…ë£Œ
                    showCustomAlert('ì„œë²„ ì—°ê²° ë¬¸ì œì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // 2. userIdê°€ ì—†ì„ ë•Œë§Œ ì‹ ê·œ ìƒì„±
            try {
                const enteredNickname = localStorage.getItem('enteredNickname');
                const username = enteredNickname || `í”Œë ˆì´ì–´${Math.floor(Math.random() * 10000)}`;
                localStorage.removeItem('enteredNickname');

                const data = await fetchJson('/api/user/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username })
                });

                currentUser = {
                    id: data.id,
                    name: data.username,
                    points: data.points
                };
                localStorage.setItem('userId', String(data.id));
                updateUserInfo();
                startPolling();
            } catch (err) {
                console.error('ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨:', err);
                showCustomAlert('ìœ ì € ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ì§€ ë§ê³  ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }
        
        function startPolling() {
            initializeBettingDisplay();
            updateBettingTotals();
            updateUserBets();
            setInterval(updateDisplay, 1000);
            setInterval(updateUserInfo, 5000);
            setInterval(updateBettingTotals, 3000);
            setInterval(updateUserBets, 3000);
        }
        let myBets = { 1: 0, 2: 0, 3: 0, 4: 0 };
        let raceStatus = 'READY';
        let serverTimer = 60;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚´ ë² íŒ… ì •ë³´ ì´ˆê¸°í™”
        function initializeBettingDisplay() {
            console.log('ë² íŒ… ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™” ì¤‘...');
            for (let horseId = 1; horseId <= 4; horseId++) {
                const myBetElement = document.getElementById(`myBet${horseId}`);
                if (myBetElement) {
                    myBetElement.textContent = `ë‚´: 0P`;
                    console.log(`ë§ ${horseId} ë² íŒ… ì´ˆê¸°í™” ì™„ë£Œ`);
                } else {
                    console.error(`myBet${horseId} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                }
            }
        }

        function updateDisplay() {
            fetch('api/status')
                .then(response => response.json())
                .then(data => {
                    raceStatus = data.status;
                    serverTimer = data.timer;
                    
                    let statusText = '';
                    if (data.status === 'READY') {
                        statusText = `ğŸ ê²½ê¸° ëŒ€ê¸° ì¤‘: ${data.timer}ì´ˆ`;
                        winnerShown = false;
                        deletedUserShown = false;
                        enableBetting();
                    } else if (data.status === 'RACING') {
                        statusText = 'ğŸƒâ€â™‚ï¸ ê²½ì£¼ ì§„í–‰ ì¤‘!';
                        disableBetting();
                    } else if (data.status === 'FINISHED') {
                        statusText = `ğŸ‰ ê²½ì£¼ ì™„ë£Œ! ìš°ìŠ¹: ${data.winnerHorse}`;
                        disableBetting();
                        if (data.topWinner) {
                            showWinnerAnnouncement(data.winnerHorse, data.topWinner);
                        }
                    }
                    document.getElementById('status-text').textContent = statusText;
                    
                    // ì‚­ì œëœ ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ (1ë²ˆë§Œ)
                    if (data.deletedUser && !deletedUserShown) {
                        deletedUserShown = true;
                        const msgDiv = document.getElementById("deleted-user-marquee");
                        const msgText = document.getElementById("marquee-text");
                        const deletedMessage = data.deletedUser;
                        msgText.textContent = "ğŸ’€ " + deletedMessage;
                        
                        msgDiv.style.display = "block";
                        msgText.style.animation = "none";
                        setTimeout(() => {
                            msgText.style.animation = "marquee 8s linear";
                        }, 10);
                        
                        setTimeout(() => {
                            msgDiv.style.display = "none";

                            // íŒŒì‚° ì´ë²¤íŠ¸ ì†Œë¹„ ì²˜ë¦¬ (ì„œë²„ ìƒíƒœ ì´ˆê¸°í™”)
                            fetch('/api/race/clear-deleted-user', {
                                method: 'POST'
                            });

                            // í˜„ì¬ ì‚¬ìš©ìê°€ íŒŒì‚°í–ˆëŠ”ì§€ í™•ì¸
                            if (deletedMessage.includes(currentUser.name)) {
                                localStorage.removeItem('userId');
                                alert('íŒŒì‚°í•˜ì—¬ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                                window.location.href = 'index.html';
                            }
                        }, 8000);
                    }
                    
                    data.horses.forEach((horse, index) => {
                        const horseElement = document.getElementById(`horse-${horse.id}`);
                        const speedElement = document.getElementById(`speed-${horse.id}`);
                        if (horseElement) {
                            const trackWidth = 800 - 120;
                            
                            if (data.status === 'READY') {
                                // READY ìƒíƒœì—ì„œëŠ” í•­ìƒ ì‹œì‘ ìœ„ì¹˜
                                horseElement.style.left = '50px';
                                speedElement.style.display = 'none';
                                horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5))';
                                horseElement.style.animation = 'horsePulse 2s ease-in-out infinite';
                                horseElement.style.transform = 'scale(1)';
                            } else {
                                // RACING/FINISHED ìƒíƒœì—ì„œëŠ” ì‹¤ì œ ìœ„ì¹˜ ê³„ì‚°
                                const position = (horse.position / 1000) * trackWidth + 50;
                                horseElement.style.left = position + 'px';
                                speedElement.style.display = 'block';
                                horseElement.style.animation = 'none';
                                
                                const randomVariation = (Math.random() - 0.5) * 20;
                                const currentSpeed = Math.max(30, Math.min(80, horse.speed + randomVariation));
                                
                                if (currentSpeed > 65) {
                                    speedElement.textContent = 'ğŸ”¥';
                                    horseElement.style.transform = 'scale(1.1)';
                                    horseElement.style.filter = 'drop-shadow(0 0 8px #ff4757) saturate(1.3)';
                                } else if (currentSpeed > 55) {
                                    speedElement.textContent = 'âš¡';
                                    horseElement.style.transform = 'scale(1.05)';
                                    horseElement.style.filter = 'drop-shadow(0 0 5px #ffa502) saturate(1.1)';
                                } else if (currentSpeed > 45) {
                                    speedElement.textContent = 'ğŸ’¨';
                                    horseElement.style.transform = 'scale(1)';
                                    horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5))';
                                } else {
                                    speedElement.textContent = 'ğŸ˜´';
                                    horseElement.style.transform = 'scale(0.95)';
                                    horseElement.style.filter = 'drop-shadow(2px 2px 0px rgba(0,0,0,0.5)) grayscale(0.3)';
                                }
                                
                                const positions = data.horses.map(h => h.position).sort((a, b) => b - a);
                                if (horse.position === positions[0] && horse.position > 100) {
                                    horseElement.style.filter += ' drop-shadow(0 0 12px #ffd700)';
                                }
                                
                                if (horse.position > 800) {
                                    horseElement.style.animation = 'finalSprint 0.3s ease-in-out infinite';
                                }
                            }
                        }
                    });
                    
                    updateBettingTotals();
                })
                .catch(error => console.error('Error:', error));
        }

        function updateBettingTotals() {
            fetch('api/betting-totals')
                .then(response => response.json())
                .then(data => {
                    console.log('ë°›ì€ ë² íŒ… ë°ì´í„°:', data);
                    
                    // ê° ë§ë³„ë¡œ ë² íŒ… ì´ì•¡ ì—…ë°ì´íŠ¸
                    for (let horseId = 1; horseId <= 4; horseId++) {
                        const totalElement = document.getElementById(`betTotal${horseId}`);
                        if (totalElement) {
                            const amountSpan = totalElement.querySelector('.amount');
                            if (amountSpan) {
                                const totalAmount = data[horseId] || 0;
                                
                                // 10ì´ˆ ì „ ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ (READY ìƒíƒœì—ì„œë§Œ)
                                if (raceStatus === 'READY' && serverTimer <= 10) {
                                    amountSpan.textContent = '???';
                                    totalElement.style.opacity = '0.5';
                                } else {
                                    amountSpan.textContent = totalAmount;
                                    totalElement.style.opacity = '1';
                                }
                            }
                        }
                    }
                })
                .catch(error => console.error('ë² íŒ… ì´ì•¡ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error));
        }

        function updateUserInfo() {
            fetch(`api/user/${currentUser.id}`)
                .then(response => response.json())
                .then(data => {
                    currentUser.points = data.points;
                    currentUser.name = data.username;
                    document.getElementById('user-points').textContent = `ğŸ’ ë³´ìœ : ${data.points}P`;
                    document.getElementById('user-name').textContent = data.username;
                })
                .catch(error => console.error('Error:', error));
        }

        function updateUserBets() {
            console.log('updateUserBets í•¨ìˆ˜ í˜¸ì¶œë¨');
            fetch(`api/user/${currentUser.id}/bets`)
                .then(response => {
                    console.log('ì‚¬ìš©ì ë² íŒ… API ì‘ë‹µ ìƒíƒœ:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('ë°›ì€ ì‚¬ìš©ì ë² íŒ… ë°ì´í„°:', data);
                    
                    // ê° ë§ë³„ë¡œ ë‚´ ë² íŒ… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
                    for (let horseId = 1; horseId <= 4; horseId++) {
                        const myBetElement = document.getElementById(`myBet${horseId}`);
                        const myAmount = data[horseId] || 0;
                        
                        console.log(`ë§ ${horseId}: ë² íŒ…ì•¡ ${myAmount}, ìš”ì†Œ ì¡´ì¬:`, !!myBetElement);
                        
                        if (myBetElement) {
                            myBets[horseId] = myAmount;
                            myBetElement.textContent = `ë‚´: ${myAmount}P`;
                            console.log(`ë§ ${horseId} ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${myAmount}P`);
                        } else {
                            console.error(`myBet${horseId} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                        }
                    }
                })
                .catch(error => {
                    console.error('ì‚¬ìš©ì ë² íŒ… ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                });
        }

        function placeBet(horseId) {
            const amount = parseInt(document.getElementById('betAmount').value);
            if (amount < 10 || amount > 1000) {
                showCustomAlert('ë² íŒ… ê¸ˆì•¡ì€ 10~1000 í¬ì¸íŠ¸ ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤!');
                return;
            }
            
            console.log(`ë§ ${horseId}ì— ${amount}P ë² íŒ… ì‹œë„`);
            
            fetch('api/bet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: currentUser.id,
                    horseId: horseId,
                    amount: amount
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ë² íŒ… ì‘ë‹µ:', data);
                showCustomAlert(data.message);
                if (data.success) {
                    console.log('ë² íŒ… ì„±ê³µ - ì •ë³´ ì—…ë°ì´íŠ¸ ì‹œì‘');
                    currentUser.points = data.user.points;
                    updateUserInfo();
                    updateBettingTotals();
                    // 1ì´ˆ í›„ ì‚¬ìš©ì ë² íŒ… ì •ë³´ ì—…ë°ì´íŠ¸
                    setTimeout(() => {
                        console.log('ì‚¬ìš©ì ë² íŒ… ì •ë³´ ì—…ë°ì´íŠ¸ ì‹œì‘');
                        updateUserBets();
                    }, 1000);
                }
            })
            .catch(error => console.error('ë² íŒ… ì˜¤ë¥˜:', error));
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('userId');
                window.location.href = 'index.html';
            }
        }

        let winnerShown = false;
        let deletedUserShown = false;
        
        function showWinnerAnnouncement(winner, topWinner) {
            const announcement = document.getElementById('winner-announcement');
            if (announcement.style.display === 'block' || winnerShown) return; // ì´ë¯¸ í‘œì‹œí–ˆìœ¼ë©´ ì¤‘ë³µ ë°©ì§€
            
            winnerShown = true;
            let countdown = 10;
            
            const updateCountdown = () => {
                announcement.innerHTML = `
                    <h2 style="color: #fff; text-shadow: 2px 2px 0px #000; margin-bottom: 15px;">ğŸ‰ ê²½ì£¼ ê²°ê³¼ ğŸ‰</h2>
                    <p style="font-size: 16px; margin-bottom: 10px;">ğŸ† ìš°ìŠ¹: ${winner}</p>
                    <p style="font-size: 14px; color: #ffd700;">ğŸ’° ìµœê³  ìˆ˜ìµ: ${topWinner}</p>
                    <p style="font-size: 12px; color: #aaa; margin-top: 15px;">${countdown}ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤...</p>
                `;
            };
            
            updateCountdown();
            announcement.style.display = 'block';
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    hideWinnerAnnouncement();
                } else {
                    updateCountdown();
                }
            }, 1000);
        }

        function hideWinnerAnnouncement() {
            const announcement = document.getElementById('winner-announcement');
            announcement.style.display = 'none';
            announcement.innerHTML = '';
            winnerShown = false;
        }

        function hideRanking() {
            document.getElementById('ranking-panel').style.display = 'none';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì´ˆê¸°í™”
        initUser();
    </script>
    <div id="version-display" style="position: fixed; bottom: 10px; right: 10px; color: rgba(255, 255, 255, 0.5); font-size: 10px; font-family: 'Press Start 2P', monospace; z-index: 9999;">Loading info...</div>

    <script>
        // ë²„ì „ ì •ë³´ ë¡œë“œ (í˜ì´ì§€ í•˜ë‹¨ì— ì¶”ê°€)
        fetch('api/version')
            .then(res => res.json())
            .then(data => {
                const text = `${data.appVersion} | ${data.serverInfo} | ${data.nginxVersion}`;
                document.getElementById('version-display').innerText = text;
            })
            .catch(e => {
                console.error("Version load failed", e);
                document.getElementById('version-display').innerText = "v1.0 | Offline";
            });
    </script>
</body>
</html>
